{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" -}}
{{- $image := "" -}}

{{- $pageResource := .Page.Resources.GetMatch $src -}}
{{- if $pageResource -}}
  {{- $image = $pageResource -}}
{{- else -}}
  {{- $galleryPage := .Site.GetPage "/gallery/postbox_toppers" -}}
  {{- if $galleryPage -}}
    {{- $filename := path.Base $src -}}
    {{- $galleryResource := $galleryPage.Resources.GetMatch $filename -}}
    {{- if $galleryResource -}}
      {{- $image = $galleryResource -}}
    {{- end -}}
  {{- end -}}
  {{- if not $image -}}
    {{- $globalResource := resources.Get $src -}}
    {{- if $globalResource -}}
      {{- $image = $globalResource -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- if $image -}}
  {{- $thumb := $image.Fill "400x300 Smart" }}
  {{- $title := $image.Title -}}
  {{- $altText := or $alt $image.Params.alt $title -}}
  <figure>
    <a href="{{ $image.RelPermalink }}" class="glightbox" data-title="{{ $title }}">
      <img src="{{ $thumb.RelPermalink }}" alt="{{ $altText }}" loading="lazy">
    </a>
    <figcaption>{{ $title }}</figcaption>
  </figure>
{{- end -}}
