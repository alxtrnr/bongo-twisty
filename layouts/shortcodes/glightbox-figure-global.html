{{- $src := .Get "src" -}}
{{- $title := .Get "title" -}}
{{- $alt := .Get "alt" -}}
{{- $image := "" -}}

{{- $pageResource := .Page.Resources.GetMatch $src -}}
{{- if $pageResource -}}
  {{- $image = $pageResource -}}
{{- else -}}
  {{- $galleryPage := .Site.GetPage "/gallery/postbox_toppers" -}}
  {{- if $galleryPage -}}
    {{- $filename := path.Base $src -}}
    {{- $galleryResource := $galleryPage.Resources.GetMatch $filename -}}
    {{- if $galleryResource -}}
      {{- $image = $galleryResource -}}
    {{- end -}}
  {{- end -}}
  {{- if not $image -}}
    {{- $globalResource := resources.Get $src -}}
    {{- if $globalResource -}}
      {{- $image = $globalResource -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- if $image -}}
  {{- $thumb := $image.Fill "400x300 Smart" }} <!-- Change dimensions as needed -->
  <figure>
    <a href="{{ $image.RelPermalink }}" class="glightbox" data-title="{{ $title }}">
      <img src="{{ $thumb.RelPermalink }}" alt="{{ $alt }}" title="{{ $title }}" width="{{ $thumb.Width }}" height="{{ $thumb.Height }}">
    </a>
  </figure>
{{- else -}}
  <figure>
    <a href="{{ $src | relURL }}" class="glightbox" data-title="{{ $title }}">
      <img src="{{ $src | relURL }}" alt="{{ $alt }}" title="{{ $title }}">
    </a>
  </figure>
{{- end -}}
